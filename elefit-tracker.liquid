{% schema %}
{
  "name": "Elefit Tracker",
  "settings": [
    {
      "type": "text",
      "id": "tracker_title",
      "label": "Tracker Title",
      "default": "Fitness Tracker"
    }
  ],
  "presets": [
    {
      "name": "Elefit Tracker",
      "category": "Custom"
    }
  ]
}
{% endschema %}

<div id="elefit-tracker-root" class="elefit-tracker-container">
  <div id="react-app-container"></div>
</div>

<script type="text/javascript">
  // Disable Shopify chat widget in our embedded app section
  window.SHOPIFY_CHAT_WIDGET = {
    disable: true
  };

  // Initialize app when DOM is ready
  document.addEventListener('DOMContentLoaded', function() {
    // Load CSS first
    const link = document.createElement('link');
    link.rel = 'stylesheet';
    link.href = "{{ 'builds.css' | asset_url }}";
    document.head.appendChild(link);

    // Load JS after CSS
    link.onload = function() {
      const script = document.createElement('script');
      script.src = "{{ 'builds.js' | asset_url }}";
      script.async = true;
      document.body.appendChild(script);

      script.onload = function() {
        console.log('Elefit Tracker loaded successfully');
      };

      script.onerror = function(error) {
        console.error('Error loading Elefit Tracker script:', error);
      };
    };

    link.onerror = function(error) {
      console.error('Error loading Elefit Tracker styles:', error);
    };
  });
</script>

<style>
  .elefit-tracker-container {
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
    min-height: 400px; /* Ensure container has height while loading */
    position: relative;
    z-index: 1; /* Ensure our app stays above other elements */
  }

  /* Add loading state styles */
  #react-app-container:empty::after {
    content: "Loading Fitness Tracker...";
    display: block;
    text-align: center;
    padding: 2em;
    font-size: 1.2em;
    color: #666;
  }

  /* Hide any potential flicker while loading */
  #react-app-container {
    opacity: 1;
    transition: opacity 0.3s ease-in-out;
  }

  #react-app-container:empty {
    opacity: 0.7;
  }

  /* Hide Shopify chat widget in our section */
  .elefit-tracker-container .shopify-chat-widget {
    display: none !important;
  }
</style>

{% comment %}Add this to prevent chat widget initialization{% endcomment %}
<script type="text/javascript">
  if (window.location.pathname.includes('/pages/fitness-tracker')) {
    window.SHOPIFY_CHAT_WIDGET = window.SHOPIFY_CHAT_WIDGET || {};
    window.SHOPIFY_CHAT_WIDGET.disable = true;
    
    // Also try to remove any existing chat widgets
    document.addEventListener('DOMContentLoaded', function() {
      const chatWidgets = document.querySelectorAll('.shopify-chat-widget, .shopify-chat-frame');
      chatWidgets.forEach(widget => {
        if (widget && widget.parentNode) {
          widget.parentNode.removeChild(widget);
        }
      });
    });
  }
</script> 